# 蓝莺IM SDK 更新记录

蓝莺IM，是由[美信拓扑](https://www.lanyingim.com/)团队研发的新一代即时通讯云服务，SDK 设计简单集成方便，服务采用云原生技术和多云架构，私有云也可按月付费。

### v3.0.5 20240119
1.markdown 展示格式增加 table 表格边框样式。
2.H5 不支持录制声音按钮点击。
3.小程序增加微信URL link 功能。
4.replace 类型消息新增appendedContent字段。
5.修复流式消息输出速度不均匀及展示位置会错乱的问题。
6.修复markdown 格式消息展示时会输出 html 未闭合标签的问题。
7.增加流式消息最长输出时间限制，消息片段最长 20s 内输出完毕。
8.设置消息渲染最短间隔时间为 40ms，优化消息展示效果。
9.优化消息第一段内没有 markdown 格式，之后消息片段到达时从文本流式消息转换为 markdown 流式消息的展示效果，防止markdown 从头开始渲染。
10.修改自动下拉逻辑，在展示时间超过消息片段间隔时，设置实际展示时间长度为自动下拉长度。

### v3.0.3 20231127
1.修改音视频信令逻辑，新增 rtc record 指令用于展示通话记录。
2.修改 sdk 处理 rtc 信令逻辑，sdk 中只存储 rtc record 信令，其它 rtc 信令不保存。
3.修改 sdk 处理 会话最新消息逻辑，过滤 rtc 非 record 消息，确保 conversation 中会话最新消息不会展示其它 rtc 消息。
4.修改音视频通话 janus 信令执行流程，会话发起端在接收到对方的 pickup 消息之后才会开始加入房间等后续逻辑处理，在两端都发布流之后才正式进入通话状态。
5.修改通话接收端逻辑，接收端同样使用 initRTCEngine 初始化音视频环境，初始化后执行 joinRoom 执行加入房间逻辑。
6.修改对端音视频流检测逻辑，检测到对端异常结束流发布后自动执行挂断操作。
7.通话建立之前，通话界面仅挂断按钮有效，屏蔽其它按键操作。
8.通话建立之前，使用本地渲染来展示本地视频展示。
9.修改支持页面启动会话页面逻辑，使用服务器返回凭证获取用户信息进行登录，确保 safari 浏览器多tab 页面下使用相同账户登录。
10.增加延迟启动音视频通话逻辑，确保过滤该设备历史离线队列中多设备支持其他端同步的历史通话消息唤醒音视频呼叫。
11.修复 H5 页面下界面无法自动下拉到最新一条消息位置的问题。
12.消息展示扩展信息按钮位置移动到消息的下方展示。
13.修改 profile 页面专属客服弹出公众号展示位置，确保微信小程序和 H5 都能正常展示。
14.调整音频呼叫和视频呼叫按钮位置，确保小屏幕手机可以正常展示全部按键。

### v3.0.2 20231031
1.H5网页端新增视频/语音单聊功能。
2.修复H5页面计算聊天界面输入框长度计算方式，适配宽页面。

### v3.0.1 20231020
1.新增markdown格式支持。
2.新增流式消息展示功能。
3.修复拉取历史消息时已经存在消息会覆盖最老历史消息的bug。
4.新增分包处理。支持微信小程序分包处理功能。
5.修复列表展示时数据变化界面展示错误的bug。
6.文本消息新增展示扩展消息功能，文本消息新增长按复制消息内容功能。
7.修复部分消息展示时格式错乱问题。

### v3.0.0 20230908
1.修复多个uni app版本已知bug。
2.修改profile页面展示，新增detail页面展示详情。
3.修改roster、group及conversation页面UI展示。
4.新增加入群组、注销账号等操作。

### v3.0.0 20230818
1.同步蓝莺IM3.0版本sdk到uni-app版本之下。
2.uni-app版本可以正常收发及展示图片、视频、文件、位置消息。
3.uni-app小程序版本修复getUserInfo函数无效导致的不能正常获取openid进行登录及进行微信绑定的问题。
4.uni-app修改微信登录流程逻辑，增加无用户使用展示状态，符合微信小程序要求。
### v2.9.17 20230310
1. 修复webim.cleanup调用后有些key没被删除的bug

### v2.9.16 20230309
1. 修复storeBase分区对partition_key等于0的情况不一致的问题

### v2.9.15 20230118
1. 修复noticeStore.saveNotice报错问题

### v2.9.14 20230114
1. 修复退出群不会触发onGroupMemberChanged事件的问题

### v2.9.13 20221229
1. 支持设置sdk日志等级

### v2.9.12 20220808
1. 优化切后台后的自动重连

### v2.9.11 20220802

1. 修复删除会话后不会收到删除会话事件的问题；
2. 增加好友申请事件通知（onRosterApplied）；
3. 修复退出并登录新用户时，可能会加载旧用户的数据的问题；

### v2.9.10 20211206

1. Fix Bug: 在未取用户信息的时候返回有效的空 RosterInfo；
2. 支持修改群扩展信息；
3. 支持群成员全体禁言；
4. 消息发送状态事件增加消息 id；

### v2.9.9 20210813

1. 收取历史消息不需要额外通知；
2. Demo bug fix: 对话中显示自己头像；
3. 七夕快乐；

### v2.9.8 20210801

1. Fix Bug: 好友信息更新时间应该使用 onRosterInfoUpdate；
2. Fix Bug: 使用 SocketTask 解决 WebSocket 连接时丢失 wx.onSocketOpen 事件问题；
3. Fix Bug: 自动登录未正确设置 isLogin，导致同一用户会出现两次登录；
4. Demo bug fix：好友信息变化后不再触发花名册更新，后者将会在处理不存在用户时引发循环请求；
5. Demo: 显示花名册好友昵称；
6. Demo: 持久化存储 AppID，页面刷新后依然使用上次设置 AppID；

### v2.9.7 20210728

1. Fix Bug: 收到 userNotice 后退出并不再重连；
2. Demo：增加 userNotice 演示；

### v2.9.5 20210303

1. 限制获取同一 ID 的好友信息频次，一秒内只能发起一次；
2. Fix bug: 群聊信息默认 status 不应为 UNREAD；

### v2.9.4 20210112

1. 支持从服务端获取消息已读未读状态；
2. 支持发送定位消息，type: location；
3. Demo: fix bug 切换 AppID 后 SDK 不初始化；

### v2.9.3 20210111

1. 使用 prettier 格式化工程；

### v2.9.2 20210110

1. 支持单独获取消息已读未读状态；
2. Fix bug：退出登录后遗留数据清理；

### v2.9.1 20210107

1. 修复私有云文件发送 bug；
2. Demo：显示视频消息；
3. Demo：小程序群语音支持；

### v2.8.2 20201103

1. 增加 SDK 初始化状态判断方法 im.isReady，并增加示例等待 SDK 初始化成功；
2. 为会话 last message 增加 ext 字段；
3. 重构 ack 存储，修复事件 onUnreadChange；
4. Fix bug: 发送者不应该发送 READ_ACK；
5. 获取历史消息可指定条数：

### v2.8.1 20201028

1. 增加新的事件通知：发送消息将会有发送中、发送成功和发送失败通知，名称 onSendingMessageStatusChanged；

### v2.8 20200924

1. 适配 v2 DNS 服务，支持国外加速节点；
2. 冻结用户和 LICENSE 相关错误不再触发重新登录；

### v2.7.2 20200915

1. 优化服务 DNS 刷新机制；
2. 增加自定义协议支持，ext 字段解析；
3. 删除会话前增加存在性检查；
4. Websocket 链接出错后回收关闭；
5. Demo：演示自定义协议；
6. Demo: 添加自动登录逻辑；

### v2.7.1 20200903

1. 优化重连策略，在网络不稳定情况下冷却重连超时；
2. Demo：去掉 onHide 里对 listener 的错误移除；
3. 弱网情况下调整最大连接超时为 90s，延迟登陆时间 10s；

### v2.7 20200825 七夕快乐

1. 支持删除远程会话；
2. 删除会话操作从 im 挪到 im.sysManage；
3. Demo：删除好友/群也会触发删除会话；
4. 性能优化：历史聊天记录不再触发 ReadAck；
5. 支持内嵌在原生 App 中使用厂商推送，可绑定/解绑 DeviceToken;

### v2.2 20200809

！此次更新涉及数据格式变化，升级注意清空本地缓存

1. 支持删除本地会话；
2. 重构 message 存储，增加分区，极大地提高了性能；

### v2.1 20200730 Uniapp 正式发布

1. 统一事件通知，增加 flooNotice，dnsError 移到 flooError；
2. 增加用户被封禁登陆失败通知 USER_BANNED；
3. 同步发布 Uniapp 版本；
4. 适配修改，多端版本统一；
5. 演示用户自定义协议，即消息 ext 字段使用；
6. 修改说明文档，解释 sourceType: 'unambiguous' 的重要性；
7. fix bug：视频图片显示路径问题；

## 之前的原生微信小程序更新日志

### v2.3 20200428

1. 提高文件访问地址 URL 的安全性；
2. 同步小程序解决音频播放问题；

### v2.2 20200425

1. 单独显示系统通知；
2. 演示群组设置；
3. 优化：把 refreshServers 从 io 挪到 dnsManange 里；

### v2.1 20200306

1. 发布使用 2.0 库；
2. 重构存储，合并小程序版本 SDK；

### v1.1 20200225

1. 为聊天室消息增加优先级；

### v1.0 20200223 正式发布

1. 支持单聊、群聊；
2. 支持文本、语音（微信小程序）、图片和视频消息；
3. 支持个人信息、头像；
4. 支持自定义协议；
5. 对接蓝莺IM 云服务，设置 appid；
